# nginx configuration for React Single Page Application (SPA)
# This file is copied into the Docker container at build time

server {
    # Listen on port 80 (standard HTTP port)
    listen 80;
    
    # Server name - can be localhost, domain name, or _ for any
    server_name localhost;
    
    # Root directory where built React files are stored in the container
    # This is where "npm run build" output gets copied to
    root /usr/share/nginx/html;
    
    # Default files to serve when accessing a directory
    index index.html index.htm;
    
    # Main location block - handles all requests
    location / {
        # try_files is the key to making React Router work!
        # 1. Try to serve the exact file requested ($uri)
        # 2. If not found, try to serve it as a directory ($uri/)
        # 3. If still not found, serve index.html (let React Router handle it)
        # This ensures /apps/discrete-log works even though the file doesn't exist
        try_files $uri $uri/ /index.html;
    }
    
    # Enable gzip compression to reduce file sizes over the network
    # This makes your website load faster for users
    gzip on;
    
    # Specify which file types should be compressed
    # These are common web file types that compress well
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # Cache static assets (JS, CSS, images) for better performance
    # The ~* means case-insensitive regex matching
    # \. matches a literal dot, | means OR
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        # Cache these files for 1 year in the browser
        expires 1y;
        
        # Tell browsers this content won't change (safe to cache permanently)
        add_header Cache-Control "public, immutable";
    }
}